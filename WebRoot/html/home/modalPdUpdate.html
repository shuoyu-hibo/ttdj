<!DOCTYPE html>
<html>
<head>
<link rel="SHORTCUT ICON" HREF="../../image/favicon.ico">
<LINK REL="Bookmark" HREF="../../image/favicon.ico">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="application-name" content="ttdaijin网－ttdaijin一次 美一次，精品生活">
<meta name="description" content="运城ttdaijin网-运城代金券首选,专业品质运城代金券网!为您提供运城美食,电影票,KTV,酒店,旅游等运城代金券大全,运城代金券网站大全运城ttdaijin网,您身边的吃喝玩乐好帮手!">
<meta name="keywords" content="运城代金券,运城代金券网,运城代金券大全,运城代金券网站,运城代金券网站大全">


<title>【运城代金券网】</title>

<link rel="stylesheet" href="../../styles/bootstrap.css" type="text/css">
<script type="text/javascript" src="../../js/jquery-1.7.2.js"></script>
<script type="text/javascript" src="../../js/bootstrap.js"></script>
<script type="text/javascript" src="../../js/ajaxfileupload.js"></script>
<script type="text/javascript" src="../../js/ourUtil.js"></script>


<!--[if IE 6]>
<script src="http://s1.ttdaijin.net/vendor/js/DD_belatedPNG_0.0.8a-min.v86c6ab94.js"></script>
<![endif]-->
<!--[if lt IE 9]>
<script src="http://s0.ttdaijin.net/vendor/js/html5shiv-es5shim.min-min.vc0ce900f.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../../styles/combo.css">
<link rel="stylesheet" type="text/css" href="../../styles/xw/ttdj1.css">
</head>


<body id="index" class="pg-floor">
<!-- 模态框（Modal） -->
<div class="modal fade" id="modalUpd" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    	修改商品信息
                </h4>
            </div>
            <div class="modal-body">
                <table class="normal" width="456" border="0" cellspacing="1" cellpadding="0" align="center" bordercolor="#0099CC" bgcolor="#CCCCCC">
                    <tr bgcolor="#FFFFFF">
                        <td height="32" width="67" nowrap>
                            <div align="center"><font class="normal">商品名称:</font></div>
                        </td>
                        <td height="32" width="386" nowrap>
                            <input class='normal' id="produceNameUpd"  type="text" name="WJMS" maxlength="200" size="40">
                        </td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <td height="32" width="67" nowrap>
                            <div align="center"><font class="normal">商品描述:</font></div>
                        </td>
                        <td height="32" width="386" nowrap>
                            <input class='normal' id="produceDescUpd"  type="text" name="WJMS" maxlength="200" size="40">
                        </td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <td height="32" width="67" nowrap>
                            <div align="center"><font class="normal">商品原价: </font></div>
                        </td>
                        <td height="32" width="386" nowrap>
                            <input class='normal' id="producePriceUpd"  type="number" name="WJMS" maxlength="200" size="40">
                        </td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <td height="32" width="67" nowrap>
                            <div align="center"><font class="normal">优惠价: </font></div>
                        </td>
                        <td height="32" width="386" nowrap>
                            <input class='normal' id="produceCouponUpd"  type="number" name="WJMS" maxlength="200" size="40">
                        </td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <td height="32" width="67" nowrap>
                            <div align="center"><font class="normal">商品现价: </font></div>
                        </td>
                        <td height="32" width="386" nowrap>
                            <input class='normal' id="producePriceNewUpd"  type="number" name="WJMS" maxlength="200" size="40">
                        </td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <td height="32" width="67" nowrap>
                            <div align="center"><font class="normal">商品类别: </font></div>
                        </td>
                        <td height="32" width="386" nowrap>
                            <select style="width:120px" id="proSort1Upd">
		                		<option></option>
			                </select>
			                <select style="width:120px" id="proSort2Upd">
			                	<option></option>
			                </select>
			                <select style="width:120px" id="proSort3Upd">
			                	<option></option>
			                </select>
                        </td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <td height="26" width="67" nowrap>
                            <div align="center"><font class="normal">商品图片:</font></div>
                        </td>
                        <td height="26" width="386" nowrap>
                            <div><img border="0" id="imgUploadUpd" src="" alt="" style="width:100px;height:100px;" /></div>
                            <input id="fileToUploadUpd"  type="file" size="45"  style="width:250px"  accept="image/*" name="file"  class="input" >
                            <button class="button" id="buttonUploadUpd" type="button"
                                    onclick="uploadUnitImageUpd();">上传选定图片</button><br>
                             <input type="hidden" id="picUrlUpd"/>                             
                         </td>
                     </tr>
                     <tr bgcolor="#FFFFFF">
					    <td height="40" width="67" nowrap>
					        <div align="center"><font class="normal">是否推荐:</font></div>
					    </td>
					    <td height="26" width="386" nowrap>
					       <label class="checkbox">
					              <input type="checkbox" id="ifPopularUpd"> (只可设置2个)
					       </label>
					    </td>
					</tr>
					<div class="alert alert-success" style="display: none;" id="okUpd">
			              <strong>恭喜:</strong> 商铺信息添加成功！
			         </div>
					<div class="alert fade in" id="warningUpd">
                       <button type="button" class="close" data-dismiss="alert">×</button>
                        <strong>提示:</strong> 请选择要上传的图片!
                    </div>
                    <div id="resultUpd" style="margin-left:200px"></div>
	                </table>
	            </div>
	            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">
              		关闭
                </button>
                <button type="button" class="btn btn-primary" id="saveUpd">
                   	 提交
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script type="text/javascript">

    $(function(){
    	$("#modalUpd").modal("show");
		$("#imgUploadUpd").attr("src","../../image/addPic.png");
		$("#warningUpd").hide();
		
		//load proSort and bgrounp start
       // $.post(generateUrl("ct!getProSort1.do?"),function(data){
        //	$("#proSort1Upd").html("<option></option>");
        //	$.each(data["record"],function(i,n){
        //		$("<option id="+n.proSortCode+"\>"+$.trim(n.proSortName)+"</option>").appendTo($("#proSort1Upd"));
        //	});
       // });
        $("#proSort1Upd").change(function(){
        	var sU = generateUrl("ct!getProSort2.do?proSortCode1="+$("#proSort1Upd option:selected").attr("id"));
        	$("#proSort2Upd").removeAttr("disabled");
        	$("#proSort2Upd").html("<option></option>");
        	$.post(sU,function(data){
	        	$.each(data["record"],function(i,n){
	        		$("<option id="+n.proSort2Code+"\>"+$.trim(n.proSort2Name)+"</option>").appendTo($("#proSort2Upd"));
        		});
       		});
       		$("#proSort2Upd").change();
        });
        $("#proSort2Upd").change(function(){
        	var sU = generateUrl("ct!getProSort3.do?proSortCode2="+$("#proSort2Upd option:selected").attr("id"));
        	$("#proSort3Upd").removeAttr("disabled");
        	$("#proSort3Upd").html("<option></option>");
        	$.post(sU,function(data){
	        	$.each(data["record"],function(i,n){
	        		$("<option id="+n.proSort3Code+"\>"+$.trim(n.proSort3Name)+"</option>").appendTo($("#proSort3Upd"));
        		});
       		});
       		$("#proSort3Upd").change();
        });
		//load proSort city county and bgrounp end
		
		$.post(generateUrl("produce!getProduceInfoById.do?produceId="+updId),function(data){
			if(data["result"]=="0"){
				$("#produceNameUpd").val(data["record"][0].produceName);
				$("#produceDescUpd").val(data["record"][0].produceDesc);
				$("#producePriceUpd").val(data["record"][0].producePrice);
				$("#produceCouponUpd").val(data["record"][0].remitPrice);
				$("#producePriceNewUpd").val(data["record"][0].finalPrice);
				$("#picUrlUpd").val(data["record"][0].producePic);
				//$("#fileToUploadUpd").attr("src",data["record"][0].producePic);
				$("#proSort1Upd").val(data["record"][0].proSort1Name);
				//$("#proSort1Upd option[value='"+data["record"][0].proSort1Name+"']").attr("selected","selected");
				$("#proSort2Upd").val(data["record"][0].proSort2Name);
				//$("#proSort2Upd option[value='"+data["record"][0].proSort2Name+"']").attr("selected","selected");
				$("#proSort3Upd").val(data["record"][0].proSort3Name);
				//$("#proSort3Upd option[value='"+data["record"][0].proSort3Name+"']").attr("selected","selected");
				var proSort1Id="";
				var proSort2Id="";
				$.post(generateUrl("ct!getProSort1.do?"),function(json){
		        	$("#proSort1Upd").html("<option></option>");
		        	$.each(json["record"],function(i,n){
		        		if(n.proSortName==data["record"][0].proSort1Name){
		        			proSort1Id=n.proSortCode;
		        			$("<option id="+n.proSortCode+" selected='selected'\>"+$.trim(n.proSortName)+"</option>").appendTo($("#proSort1Upd"));
		        		}else{
		        			$("<option id="+n.proSortCode+"\>"+$.trim(n.proSortName)+"</option>").appendTo($("#proSort1Upd"));
		        		}
		        	});
		        	selectedSort2(proSort1Id,data["record"][0].proSort2Name,data["record"][0].proSort3Name);
		        });
			}
		});
	
		
		$("#saveUpd").click(function(){
	    	if(!checkInputUpd("produceNameUpd","商品名称")){
	    		return;
	    	}
	    	if(!checkInputUpd("produceDescUpd","商品描述")){
	    		return;
	    	}
	    	if(!checkInputUpd("producePriceUpd","商品原价")){
	    		return;
	    	}
	    	if(!checkInputUpd("produceCouponUpd","优惠价")){
	    		return;
	    	}
	    	if(!checkInputUpd("producePriceNewUpd","商品现价")){
	    		return;
	    	}
	    	if(!checkInputUpd("proSort1Upd","商品一级分类")){
	    		return;
	    	}
	    	if($("#picUrlUpd").val()==''){
	    		$("#warningUpd").html('<strong>提示:</strong> 请选择要上传的图片!');
	    		$("#warningUpd").toggle(true);
	    	}else{
	    		$("#warningUpd").toggle(false);
	    		var sul = "produce!updateProduceData.do?produceId="+updId+"&proSort1CodeUpd="+$("#proSort1Upd option:selected").attr("id");
		    	if($("#proSort2Upd option:selected").attr("id")!=undefined){
		    		sul += "&proSort2CodeUpd="+$("#proSort2Upd option:selected").attr("id");
		    	}
		    	if($("#proSort3Upd option:selected").attr("id")!=undefined){
			    	sul += "&proSort3CodeUpd="+$("#proSort3Upd option:selected").attr("id");
		    	}
		    	if($("#ifPopularUpd").attr("checked")=='checked'){
		    		sul +="&ifPopularUpd=Y"
		    	}
		    	sul += "&";
	    		var strUrl = generateUrl(sul,"produceNameUpd,produceDescUpd,producePriceUpd,produceCouponUpd,producePriceNewUpd,picUrlUpd,proSort1Upd,proSort2Upd,proSort3Upd");
	    		$.post(strUrl,function(json){
					if(json["result"]=="0"){
						//$("#ok").show();
						//$("#modalUpd").modal("hide");
						$("#modalUpd").modal("hide");
						loadProduce();
					}else{
						$("#warningUpd").html('<strong>提示:</strong> 商品添加失败!');
	    				$("#warningUpd").toggle(true);
					}
				});
	    	}
	    });
	    
	});
	
	function selectedSort2(proSort1Id,proSort2Name,proSort3Name){
		var strUrl = generateUrl("ct!getProSort2.do?proSortCode1="+proSort1Id);
		$.post(strUrl,function(json){
			$("#proSort2Upd").html("<option></option>");
        	$.each(json["record"],function(i,n){
        		if(n.proSort2Name==proSort2Name){
        			proSort2Id=n.proSort2Code;
			        $("<option id="+n.proSort2Code+" selected='selected' \>"+$.trim(n.proSort2Name)+"</option>").appendTo($("#proSort2Upd"));
        		}else{
	        		$("<option id="+n.proSort2Code+"\>"+$.trim(n.proSort2Name)+"</option>").appendTo($("#proSort2Upd"));
        		}
  			});
  			selectedSort3(proSort2Id,proSort3Name);
		});
	}
	
	function selectedSort3(proSort2Id,proSort3Name){
		var sU = generateUrl("ct!getProSort3.do?proSortCode2="+proSort2Id);
       	$("#proSort3Upd").html("<option></option>");
       	$.post(sU,function(json){
        	$.each(json["record"],function(i,n){
        		if(n.proSort3Name==proSort3Name){
        			$("<option id="+n.proSort3Code+" selected='selected' \>"+$.trim(n.proSort3Name)+"</option>").appendTo($("#proSort3Upd"));
        		}else{
	        		$("<option id="+n.proSort3Code+"\>"+$.trim(n.proSort3Name)+"</option>").appendTo($("#proSort3Upd"));
        		}
       		});
      	});
	}
	
	function checkInputUpd(inputId,inputName){//checkinput for produceinfo
    	if($("#"+inputId).val()=='' || $("#"+inputId).val()==undefined){
	    		$("#warningUpd").html("<strong>提示:</strong> 请输入"+inputName+"!");
	    		$("#warningUpd").show();
	    		$("#okUpd").hide();
	    		return false;
	    }
	    $("#warningUpd").hide();
	    return true;
    }
    
     /** 
     * upload Picture
     */  
    function uploadUnitImageUpd()  {  
    		$("#pageloading").show();
            if($("#fileToUploadUpd").val()==''){
            	$("#warningUpd").show();
            	return;
            }
             $.ajaxFileUpload({  
                 url:generateUrl("produce!uploadImage.do?"),             //需要链接到服务器地址  
                 secureuri:false,  
                 fileElementId:'fileToUploadUpd',                         //文件选择框的id属性  
                 dataType: 'json',                                     //服务器返回的格式，可以是json  
                 success: function (data, status)             //相当于java中try语句块的用法  
                 {     
                 //alert(data);       //data是从服务器返回来的值     
                	 $("#pageloading").hide();
                     $('#resultUpd').html(data["msg"]);  
                     var imgPath="../../uploadfiles/"+data["newname"];
   					 $("#imgUploadUpd").attr("src",imgPath);
   					 $("#picUrlUpd").val(imgPath);
   					 $("#warningUpd").hide();
   					 return 0;
                 },  
                 error: function (data, status, e)             //相当于java中catch语句块的用法  
                 {  
                 	$("#pageloading").hide();
                     $('#resultUpd').html(data["msg"]);  
                     $("#warningUpd").hide();
                     return 1;
                 }  
               }  
             );  
    }  
    
</script>
</body>

</html>
